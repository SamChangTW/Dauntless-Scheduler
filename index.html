<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Dauntless Scheduler v2.6.1 — Cloud Edition</title>
  <link rel="manifest" href="manifest.webmanifest"/>
  <meta name="theme-color" content="#111318"/>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <div class="wrap">
    <div class="row header">
      <div class="h">Dauntless Scheduler <span class="brand">v2.6.1 — Cloud Edition</span></div>
      <button class="btn" id="btnInstall">加到主畫面</button>
    </div>

    <div class="row badges">
      <div class="pill">資料源：<b id="srcLabel">偵測中</b></div>
      <div class="pill"><span class="dot ok"></span> 已排賽程</div>
      <div class="pill"><span class="dot bad"></span> 需避開（日）</div>
      <button class="btn" id="btnOpenEditor">📝 建立 / 編輯賽程</button>
      <button class="btn" id="btnQueryAvoid">🔴 查詢需避開（日）</button>
      <button class="btn" id="btnReload">↻ 重新載入</button>
    </div>

    <div class="row kpis">
      <div class="panel kpi">
        <div class="muted">本季週日數</div><div class="num" id="kpiWeeks">—</div>
      </div>
      <div class="panel kpi">
        <div class="muted">本季已排</div><div class="num" id="kpiThisBooked">—</div>
      </div>
      <div class="panel kpi">
        <div class="muted">次季已排</div><div class="num" id="kpiNextBooked">—</div>
      </div>
      <div class="panel kpi">
        <div class="muted">需避開（總）</div><div class="num" id="kpiAvoid">—</div>
      </div>
    </div>

    <div class="panel">
      <div class="panel-title">本季（日） <span class="muted" id="rangeThis"></span></div>
      <div class="slots" id="gridThis"></div>
    </div>

    <div class="panel">
      <div class="panel-title">次季（日） <span class="muted" id="rangeNext"></span></div>
      <div class="slots" id="gridNext"></div>
    </div>

    <div class="footer">© 2025 Dauntless Scheduler — Cloud Edition v2.6.1</div>
  </div>

  <dialog id="dlgEditor">
    <div class="md">
      <h3>建立 / 編輯賽程</h3>
      <div class="muted">選擇一個週日或直接輸入日期（YYYY-MM-DD）。若該日已存在將覆寫。</div>
    </div>
    <div class="md">
      <div class="fld">
        <div class="fld-col">
          <label>日期（YYYY-MM-DD）</label>
          <input id="fDate" placeholder="2025-11-16"/>
        </div>
        <div class="fld-col">
          <label>聯盟（league）</label>
          <select id="fLeague">
            <option value="TSAA">TSAA</option>
            <option value="海客">海客</option>
            <option value="美堤">美堤</option>
          </select>
        </div>
        <div class="fld-col">
          <label>狀態（status）</label>
          <select id="fStatus">
            <option value="booked">booked（已排）</option>
            <option value="avoid">avoid（需避開）</option>
            <option value="">空白</option>
          </select>
        </div>
      </div>
      <div class="fld">
        <div class="fld-col full">
          <label>備註（note）</label>
          <textarea id="fNote" rows="3" placeholder="如：海客 vs 巨人（下午場）"></textarea>
        </div>
      </div>
      <div class="fld">
        <button class="btn" id="btnPickSunday">從兩季週日快速選擇</button>
        <span class="muted">（點清單上的週日會自動帶入日期到輸入框）</span>
      </div>
      <div class="fld" id="inlineSundayList" style="display:none"></div>
    </div>
    <div class="row-end">
      <button class="btn" onclick="document.getElementById('dlgEditor').close()">取消</button>
      <button class="btn" id="btnSave">儲存（寫入雲端）</button>
    </div>
  </dialog>

  <dialog id="dlgAvoid">
    <div class="md">
      <h3>查詢需避開（日）</h3>
      <div class="muted">從今天起的兩季週日中，與「已排賽程」或「連續假期」衝突的日期。</div>
    </div>
    <div class="md" id="avoidList"></div>
    <div class="row-end"><button class="btn" onclick="document.getElementById('dlgAvoid').close()">關閉</button></div>
  </dialog>

  <script>
    window.__API_URL__ = "https://script.google.com/macros/s/AKfycbyG-9dcgQyZ66tOGjmjwiaUOwM-VmKWaRM4AFjASDPF3r3ONP0ILPh_LeOA7sADcATZ/exec";
    window.__SHEET_URL_SCHEDULE_CSV__ = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT-aNX0ZKFieLDhZpFlRuxioW_plgSinAG10yvaZYCGNzVIDcNTl22r-SYZ_zUuVfFxWWRUPV8USsF3/pub?output=csv";
    window.__SHEET_URL_HOLIDAY_CSV__  = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQPWkSisyPrrYRbZirLg6Xc9v1Z7eQHeO-aBNYbopP2pfqj5PAkqhznaYnmJzQh2H1PRnL_-GeMThYT/pub?output=csv";
  </script>
  <script src="app.js"></script>
</body>
</html>

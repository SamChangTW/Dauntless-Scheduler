<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Dauntless Scheduler v2.7 — CloudLink Stable (Final)</title>
  <meta name="theme-color" content="#111318"/>
  <link rel="manifest" href="manifest.json"/>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <div id="friday-console"></div>
  <div class="wrap">
    <div class="row header">
      <div class="h">Dauntless Scheduler <span class="brand">v2.7 — CloudLink Stable</span></div>
      <div class="pill">資料源：<b id="srcLabel">偵測中</b></div>
    </div>

    <div class="row badges">
      <div class="pill"><span class="dot ok"></span> 已排賽程</div>
      <div class="pill"><span class="dot bad"></span> 需避開（日）</div>
      <button class="btn" id="btnOpenEditor">📝 建立 / 編輯賽程</button>
      <button class="btn" id="btnQueryAvoid">🔴 查詢需避開（日）</button>
      <button class="btn" id="btnReload">↻ 重新載入</button>
    </div>

    <div class="row kpis">
      <div class="panel kpi">
        <div class="muted">本季週日數</div><div class="num" id="kpiWeeks">—</div>
      </div>
      <div class="panel kpi">
        <div class="muted">本季已排</div><div class="num" id="kpiThisBooked">—</div>
      </div>
      <div class="panel kpi">
        <div class="muted">次季已排</div><div class="num" id="kpiNextBooked">—</div>
      </div>
      <div class="panel kpi">
        <div class="muted">需避開（總）</div><div class="num" id="kpiAvoid">—</div>
      </div>
    </div>

    <div class="panel">
      <div class="panel-title">本季（日） <span class="muted" id="rangeThis"></span></div>
      <div class="slots" id="gridThis"></div>
    </div>

    <div class="panel">
      <div class="panel-title">次季（日） <span class="muted" id="rangeNext"></span></div>
      <div class="slots" id="gridNext"></div>
    </div>

    <div class="footer">© 2025 Dauntless Scheduler — CloudLink Stable v2.7 · <span id="deployTarget">https://samchangtw.github.io/Dauntless-Scheduler/</span></div>
  </div>

  <dialog id="dlgEditor">
    <div class="md">
      <h3>建立 / 編輯賽程</h3>
      <div class="muted">輸入（YYYY-MM-DD 或 YYYY/M/D 皆可），或由清單點選。若該日已存在將覆寫。</div>
    </div>
    <div class="md">
      <div class="fld">
        <div class="fld-col">
          <label>日期</label>
          <input id="fDate" placeholder="2025-11-16"/>
        </div>
        <div class="fld-col">
          <label>聯盟（league）</label>
          <select id="fLeague">
            <option value="海客">海客</option>
            <option value="美堤">美堤</option>
            <option value="TSAA">TSAA</option>
          </select>
        </div>
        <div class="fld-col">
          <label>狀態（status）</label>
          <select id="fStatus">
            <option value="booked">booked（已排）</option>
            <option value="avoid">avoid（需避開）</option>
            <option value="">空白</option>
          </select>
        </div>
      </div>
      <div class="fld">
        <div class="fld-col full">
          <label>備註（note）</label>
          <textarea id="fNote" rows="3" placeholder="如：海客 vs 巨人（下午場）"></textarea>
        </div>
      </div>
      <div class="fld">
        <button class="btn" id="btnPickSunday">從兩季週日快速選擇</button>
        <span class="muted">（點清單上的週日會自動帶入日期）</span>
      </div>
      <div class="fld" id="inlineSundayList" style="display:none"></div>
    </div>
    <div class="row-end">
      <button class="btn" onclick="document.getElementById('dlgEditor').close()">取消</button>
      <button class="btn" id="btnSave">儲存（寫入雲端）</button>
    </div>
  </dialog>

  <dialog id="dlgAvoid">
    <div class="md">
      <h3>查詢需避開（日）</h3>
      <div class="muted">從今天起兩季週日中，與已排或連休衝突的日期。</div>
    </div>
    <div class="md" id="avoidList"></div>
    <div class="row-end"><button class="btn" onclick="document.getElementById('dlgAvoid').close()">關閉</button></div>
  </dialog>

  <script>if('serviceWorker' in navigator){navigator.serviceWorker.register('./sw.js').catch(()=>{{}})}</script>
  <script src="config.js"></script>
  <script src="fridaySyncConsole.js"></script>
  <script src="main.js"></script>
</body>
</html>
